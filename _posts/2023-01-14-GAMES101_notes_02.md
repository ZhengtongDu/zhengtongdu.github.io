---
layout: post
title: GAMES101_notes_02
date: 2023-01-14 23:44 +0800
tags: ["Learning Notes", "GAMES101"]
toc: true
---

> GAMES101: 现代计算机图形学入门
>
> 笔记02：Shading,

## Lesson 07 Shading 1(Illumination, Shading and Graphics Pipeline)

本讲内容：

- Visibility/ occlusion
  - Z-buffering
- Shading
  - Illumination & Shading
  - Graphics Pipeline

### Visibility 可见性

#### Painter's Algorithm

受油画绘画技术的启发，作画时应当先画远处的物体，再画近处的物体，从而保证物体遮挡的结果是正确的

问题是如何判断哪个物体远，哪个物体近？相同远近的物体，绘画顺序怎么样确定？

需要首先对三角形进行排序，需要$O(n\log n)$的时间，但是不能完全解决问题

### Z-buffer 深度缓存

用于解决上述提到的问题

Idea:

- Store current min. z-value __for each sample(pixel)__
- Needs an additional buffer for depth values
  - frame buffer stores color values
  - depth buffer (z-buffer) stores depth

Important: For simplicity we suppose $z$ is always positive(smaller $z$ -> closer, larger $z$ -> further)

#### 算法流程

- Initialize depth buffer to $\infty$
- During rasterization:

```c++
    for(each triangle T)
        for(each sample(x, y, z) in T)
            if(z < zbuffer[x, y])           // closest sample so far
                framebuffer[x, y] = rgb;    // update color
                zbuffer[x, y] = z;          // update depth
            else
                ;                           // do nothing, this sample is occluded
```

（目前只是说明在已知深度的情况下如何处理遮挡关系，还未介绍如何确定物体深度）

#### 正确性和复杂度

复杂度

- 对于$n$个三角形只需要花费$O(n)$的时间
- 并不是排序算法，所以时间消耗是线性的

不同三角形处理顺序不改变结果(但是会被舍入误差影响)

Most important visibility algorithm

- Implemented in hardware for all GPUs

#### 对于MSAA的影响

当采用MSAA时，深度缓存应当是对每个采样点，而不是对每个像素进行采样

## Shading 着色

目前已经学过的内容：

- Position objects and the camera in the world 空间中的模型和摄像机
- Compute position of objects relative to the camera 计算模型位置
- Project objects onto the screen 投影
- Sample triangle coverage 光栅化

下一步的操作：着色（Shading）

### Definition of Shading

- The definition in the dictionary: The darkening or coloring of an illustration or diagram with parallel lines or a block of color.
- The definition in this course: The process of applying a material to an object.

### A Simple Shading Model(Blinn-Phong Reflectance Model)

#### Perceptual Observations

- Specular highlights 高光
- Diffuse reflection 漫反射
- Ambient lighting 环境光照

#### Shading is Local

Compute light reflected toward camera at specific __shading point__

Input:

- Viewer direction, $v$
- Surface normal, $n$
- Light direction(for each of many lights), $l$
- Surfaces parameters(colors, shininess, ...)

注意：着色并不是添加阴影！（shading $\ne$ shadow）

#### Diffuse Reflection

- Light is scattered uniformly in all directions
  - Surface color is the same for all viewing directions
- But how much light(energy) is received?
  - Lambert's cosine law：随着光线和平面法线夹角$\theta$的不断扩大，单位面积接收到的光线能量逐渐变小，比例满足$\cos \theta = l \cdot n$

#### Light Falloff 能量耗散

将光源视为一个持续释放能量的点，则随着传播距离的增加，能量的大小应当与距离的平方成反比。

#### Lambertian(Diffuse) Shading

Shading __independent__ of view direction

$$
L_d = k_d(I/r^2)\max(0, \mathbf{n} \cdot \mathbf{l})
$$

其中

- $L_d$: diffusely reflected light
- $k_d$: diffuse coefficient (color)
- $(I/r^2)$: energy arrived at the shading point
- $\max(0, \mathbf{n}\cdot \mathbf{l})$: energy received by the shading point
